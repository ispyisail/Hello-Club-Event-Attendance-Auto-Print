<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hello Club - Control Center</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <h1>ğŸ‰ Hello Club - Control Center</h1>
            <div class="header-status">
                <span id="connection-status" class="status-indicator status-connecting">Connecting...</span>
                <span id="service-status-badge" class="status-badge">Unknown</span>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="tabs">
        <button class="tab-button active" data-tab="dashboard">ğŸ“Š Dashboard</button>
        <button class="tab-button" data-tab="service">âš™ï¸ Service Control</button>
        <button class="tab-button" data-tab="config">ğŸ”§ Configuration</button>
        <button class="tab-button" data-tab="logs">ğŸ“„ Logs</button>
        <button class="tab-button" data-tab="monitoring">ğŸ“ˆ Monitoring</button>
        <button class="tab-button" data-tab="tools">ğŸ› ï¸ Tools</button>
        <button class="tab-button" data-tab="setup">ğŸš€ Setup Wizard</button>
        <button class="tab-button" data-tab="about">â„¹ï¸ About</button>
    </nav>

    <!-- Main Content Area -->
    <main class="main-content">
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <h2>System Dashboard</h2>

            <div class="dashboard-grid">
                <!-- Service Status Card -->
                <div class="card">
                    <h3>ğŸ”„ Service Status</h3>
                    <div id="dashboard-service-status">
                        <p>Loading...</p>
                    </div>
                </div>

                <!-- Database Stats Card -->
                <div class="card">
                    <h3>ğŸ—„ï¸ Database</h3>
                    <div id="dashboard-db-stats">
                        <p>Loading...</p>
                    </div>
                </div>

                <!-- Health Status Card -->
                <div class="card">
                    <h3>ğŸ’š Health Status</h3>
                    <div id="dashboard-health">
                        <p>Loading...</p>
                    </div>
                </div>

                <!-- Recent Activity Card -->
                <div class="card">
                    <h3>ğŸ“‹ Recent Activity</h3>
                    <div id="dashboard-activity">
                        <p>Loading...</p>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <h3>Quick Actions</h3>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="fetchEvents()">ğŸ“¥ Fetch Events</button>
                    <button class="btn btn-primary" onclick="processSchedule()">â–¶ï¸ Process Schedule</button>
                    <button class="btn btn-warning" onclick="createBackup()">ğŸ’¾ Create Backup</button>
                    <button class="btn btn-info" onclick="switchTab('logs')">ğŸ“„ View Logs</button>
                </div>
            </div>
        </div>

        <!-- Service Control Tab -->
        <div id="service" class="tab-content">
            <h2>Service Control</h2>

            <div class="card">
                <h3>Windows Service Management</h3>

                <div id="service-status-detail">
                    <p>Loading service status...</p>
                </div>

                <div class="button-group">
                    <button class="btn btn-success" onclick="startService()">â–¶ï¸ Start Service</button>
                    <button class="btn btn-danger" onclick="stopService()">â¹ï¸ Stop Service</button>
                    <button class="btn btn-warning" onclick="restartService()">ğŸ”„ Restart Service</button>
                </div>

                <div id="service-operation-result" class="operation-result"></div>
            </div>

            <div class="card">
                <h3>Service Information</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <strong>Service Name:</strong> HelloClubAttendance
                    </div>
                    <div class="info-item">
                        <strong>Display Name:</strong> Hello Club Event Attendance
                    </div>
                    <div class="info-item">
                        <strong>Description:</strong> Automatically prints event attendance lists
                    </div>
                    <div class="info-item">
                        <strong>Startup Type:</strong> <span id="service-startup-type">Loading...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configuration Tab -->
        <div id="config" class="tab-content">
            <h2>Configuration</h2>

            <!-- File Status Banner -->
            <div id="config-status-banner" class="status-banner" style="display: none;"></div>

            <div class="card">
                <h3>Application Settings (config.json)</h3>
                <div id="config-editor">
                    <div id="config-file-status" class="file-status"></div>
                    <textarea id="config-json" rows="20" class="config-textarea" placeholder="Loading configuration..."></textarea>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="saveConfig()">ğŸ’¾ Save Configuration</button>
                        <button class="btn btn-secondary" onclick="loadConfig()">ğŸ”„ Reload</button>
                        <button class="btn btn-info" onclick="validateConfig()">âœ“ Validate JSON</button>
                        <button id="btn-create-config" class="btn btn-success" onclick="createConfigFromExample()" style="display: none;">
                            ğŸ“„ Create from Example
                        </button>
                    </div>
                    <div id="config-result" class="operation-result"></div>
                </div>
            </div>

            <div class="card">
                <h3>Environment Variables (.env)</h3>
                <div id="env-editor">
                    <div class="env-info">
                        ğŸ’¡ <strong>Tip:</strong> You can now edit your .env file directly in the GUI!
                        Changes will be saved to the .env file.
                    </div>
                    <div id="env-file-status" class="file-status"></div>
                    <textarea id="env-content" rows="15" class="config-textarea" placeholder="Loading .env file..."></textarea>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="saveEnv()">ğŸ’¾ Save .env File</button>
                        <button class="btn btn-secondary" onclick="loadEnv()">ğŸ”„ Reload</button>
                        <button id="btn-create-env" class="btn btn-success" onclick="createEnvFromExample()" style="display: none;">
                            ğŸ“„ Create from Example
                        </button>
                    </div>
                    <div id="env-result" class="operation-result"></div>
                </div>
            </div>
        </div>

        <!-- Logs Tab -->
        <div id="logs" class="tab-content">
            <h2>Application Logs</h2>

            <div class="card">
                <div class="log-controls">
                    <div class="button-group">
                        <button class="btn btn-sm" onclick="loadLogs('activity')">ğŸ“ Activity Log</button>
                        <button class="btn btn-sm btn-danger" onclick="loadLogs('error')">âŒ Error Log</button>
                        <button class="btn btn-sm btn-success" onclick="toggleAutoRefresh()">
                            <span id="auto-refresh-indicator">ğŸ”„ Auto-Refresh: ON</span>
                        </button>
                    </div>
                    <div>
                        <label for="log-lines">Lines:</label>
                        <select id="log-lines" onchange="loadLogs()">
                            <option value="50">50</option>
                            <option value="100" selected>100</option>
                            <option value="200">200</option>
                            <option value="500">500</option>
                        </select>
                    </div>
                </div>

                <div class="log-viewer">
                    <div id="log-content"></div>
                </div>
            </div>
        </div>

        <!-- Monitoring Tab -->
        <div id="monitoring" class="tab-content">
            <h2>System Monitoring</h2>

            <!-- Circuit Breakers -->
            <div class="card">
                <h3>âš¡ Circuit Breakers</h3>
                <div id="circuit-breakers">
                    <p>Loading circuit breaker states...</p>
                </div>
            </div>

            <!-- Dead Letter Queue -->
            <div class="card">
                <h3>ğŸ’€ Dead Letter Queue</h3>
                <div id="dead-letter-queue">
                    <p>Loading failed jobs...</p>
                </div>
            </div>

            <!-- Metrics -->
            <div class="card">
                <h3>ğŸ“Š Performance Metrics</h3>
                <div id="metrics">
                    <p>Loading metrics...</p>
                </div>
            </div>
        </div>

        <!-- Tools Tab -->
        <div id="tools" class="tab-content">
            <h2>Tools & Utilities</h2>

            <div class="tools-grid">
                <div class="card">
                    <h3>ğŸ“¥ Event Management</h3>
                    <p>Manually fetch and process events</p>
                    <div class="button-group">
                        <button class="btn btn-primary" onclick="fetchEvents()">Fetch Events</button>
                        <button class="btn btn-primary" onclick="processSchedule()">Process Schedule</button>
                    </div>
                    <div id="event-tools-result" class="operation-result"></div>
                </div>

                <div class="card">
                    <h3>ğŸ’¾ Backup Management</h3>
                    <p>Create and manage database backups</p>
                    <div class="button-group">
                        <button class="btn btn-warning" onclick="createBackup()">Create Backup Now</button>
                    </div>
                    <div id="backup-result" class="operation-result"></div>
                </div>

                <div class="card">
                    <h3>ğŸ—‘ï¸ Cache Management</h3>
                    <p>Clear PDF cache to force regeneration</p>
                    <div class="button-group">
                        <button class="btn btn-danger" onclick="clearCache()">Clear PDF Cache</button>
                    </div>
                    <div id="cache-result" class="operation-result"></div>
                </div>

                <div class="card">
                    <h3>ğŸ”§ System Commands</h3>
                    <p>Access to all CLI commands</p>
                    <div class="command-list">
                        <code>node src/index.js --help</code>
                        <code>node src/index.js health-check</code>
                        <code>node src/index.js metrics-server</code>
                    </div>
                </div>
            </div>
        </div>

        <!-- Setup Wizard Tab -->
        <div id="setup" class="tab-content">
            <h2>Setup Wizard</h2>

            <div class="setup-wizard">
                <div class="card">
                    <h3>ğŸ¯ Step 1: Install Windows Service</h3>
                    <p>Choose your preferred service installation method:</p>

                    <div class="setup-option">
                        <h4>Option A: NSSM (Recommended)</h4>
                        <ol>
                            <li>Run: <code>NSSM - Step 1 - Download NSSM.bat</code></li>
                            <li>Run: <code>NSSM - Step 2 - Install Service.bat</code></li>
                            <li>Service will start automatically</li>
                        </ol>
                    </div>

                    <div class="setup-option">
                        <h4>Option B: node-windows</h4>
                        <ol>
                            <li>Run: <code>Install Service.bat</code></li>
                            <li>Service will start automatically</li>
                        </ol>
                    </div>
                </div>

                <div class="card">
                    <h3>ğŸ”‘ Step 2: Configure API Key</h3>
                    <ol>
                        <li>Copy <code>.env.example</code> to <code>.env</code></li>
                        <li>Edit <code>.env</code> and add your <code>API_KEY</code></li>
                        <li>Restart the service</li>
                    </ol>
                    <p><a href="#" onclick="switchTab('config'); return false;">â†’ Go to Configuration</a></p>
                </div>

                <div class="card">
                    <h3>âš™ï¸ Step 3: Configure Settings</h3>
                    <ol>
                        <li>Go to Configuration tab</li>
                        <li>Edit <code>config.json</code> settings</li>
                        <li>Save and restart service</li>
                    </ol>
                    <p><a href="#" onclick="switchTab('config'); return false;">â†’ Go to Configuration</a></p>
                </div>

                <div class="card">
                    <h3>âœ… Step 4: Test the Service</h3>
                    <ol>
                        <li>Go to Tools tab</li>
                        <li>Click "Fetch Events"</li>
                        <li>Click "Process Schedule"</li>
                        <li>Check logs for results</li>
                    </ol>
                    <p><a href="#" onclick="switchTab('tools'); return false;">â†’ Go to Tools</a></p>
                </div>
            </div>
        </div>

        <!-- About Tab -->
        <div id="about" class="tab-content">
            <h2>About Hello Club Event Attendance Auto-Print</h2>

            <div class="card">
                <h3>â„¹ï¸ System Information</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <strong>Application:</strong> Hello Club Event Attendance Auto-Print
                    </div>
                    <div class="info-item">
                        <strong>Version:</strong> 1.0.0
                    </div>
                    <div class="info-item">
                        <strong>GUI Server:</strong> Running on port 3000
                    </div>
                    <div class="info-item">
                        <strong>Dashboard:</strong> Running on port 3030
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>ğŸš€ Features</h3>
                <ul class="feature-list">
                    <li>âœ… Automated event fetching from Hello Club API</li>
                    <li>âœ… Scheduled PDF generation and printing</li>
                    <li>âœ… Windows Service support (NSSM + node-windows)</li>
                    <li>âœ… Real-time web-based monitoring</li>
                    <li>âœ… Circuit breaker pattern for resilience</li>
                    <li>âœ… Dead letter queue for failed jobs</li>
                    <li>âœ… Automated database backups</li>
                    <li>âœ… PDF caching for performance</li>
                    <li>âœ… Comprehensive logging and metrics</li>
                    <li>âœ… Email integration (optional)</li>
                </ul>
            </div>

            <div class="card">
                <h3>ğŸ“š Documentation</h3>
                <ul>
                    <li><a href="../../../README.md" target="_blank">README.md</a> - Complete documentation</li>
                    <li><a href="../../../WINDOWS-SERVICE-SETUP.md" target="_blank">WINDOWS-SERVICE-SETUP.md</a> - Service installation guide</li>
                    <li><a href="../../../NSSM-QUICK-START.md" target="_blank">NSSM-QUICK-START.md</a> - NSSM setup guide</li>
                    <li><a href="../../../BUILDING-EXECUTABLE.md" target="_blank">BUILDING-EXECUTABLE.md</a> - Executable build guide</li>
                    <li><a href="../../../GUI-CONTROL-CENTER.md" target="_blank">GUI-CONTROL-CENTER.md</a> - GUI documentation</li>
                </ul>
            </div>

            <div class="card">
                <h3>ğŸ”— Quick Links</h3>
                <ul>
                    <li><a href="http://localhost:3030" target="_blank">ğŸ“Š Legacy Dashboard (Port 3030)</a></li>
                    <li><a href="http://localhost:9090/metrics" target="_blank">ğŸ“ˆ Prometheus Metrics (Port 9090)</a></li>
                    <li><a href="#" onclick="switchTab('logs'); return false;">ğŸ“„ View Logs</a></li>
                    <li><a href="#" onclick="switchTab('monitoring'); return false;">ğŸ“ˆ Monitoring</a></li>
                </ul>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>Hello Club Event Attendance Auto-Print &copy; 2024 | Last Update: <span id="last-update">Never</span></p>
    </footer>

    <!-- JavaScript -->
    <script src="/js/app.js"></script>
</body>
</html>
